#include "fliter.h"

#define BLOCK_SIZE 6 //调用一次 arm_fir_f32 处理的采样点个数
#define NUM_TAPS 101 //滤波器系数个数
uint32_t blockSize = BLOCK_SIZE; 
uint32_t numBlocks = ADC_FIFO_SAMPLES/BLOCK_SIZE; //需要调用 arm_fir_f32 的次数
float testOutput[ADC_FIFO_SAMPLES]; //滤波后的输出
static float firStatef32[BLOCK_SIZE + NUM_TAPS - 1];

const float32_t firCoeffsF32LP[101] = {
   0.001458955579, 0.001476477017,   0.0015270859, 0.001610647887, 0.001726895571,
   0.001875429531, 0.002055719495, 0.002267106902,  0.00250880653, 0.002779910341,
   0.003079391085, 0.003406104865, 0.003758798121,  0.00413611019, 0.004536579829,
   0.004958651494, 0.005400680006, 0.005860938691,  0.00633762544, 0.006828870624,
   0.007332743146, 0.007847259752, 0.008370392956, 0.008900077082, 0.009434218518,
   0.009970705956,  0.01050741319,  0.01104221493,   0.0115729887,  0.01209762692,
    0.01261404715,  0.01312019583,  0.01361405943,  0.01409367286,  0.01455712691,
    0.01500257477,  0.01542824227,  0.01583243161,  0.01621353254,  0.01657002233,
    0.01690047793,  0.01720358431,  0.01747812703,  0.01772301272,  0.01793726347,
    0.01812002063,  0.01827055588,  0.01838826574,  0.01847268268,  0.01852346957,
    0.01854041964,  0.01852346957,  0.01847268268,  0.01838826574,  0.01827055588,
    0.01812002063,  0.01793726347,  0.01772301272,  0.01747812703,  0.01720358431,
    0.01690047793,  0.01657002233,  0.01621353254,  0.01583243161,  0.01542824227,
    0.01500257477,  0.01455712691,  0.01409367286,  0.01361405943,  0.01312019583,
    0.01261404715,  0.01209762692,   0.0115729887,  0.01104221493,  0.01050741319,
   0.009970705956, 0.009434218518, 0.008900077082, 0.008370392956, 0.007847259752,
   0.007332743146, 0.006828870624,  0.00633762544, 0.005860938691, 0.005400680006,
   0.004958651494, 0.004536579829,  0.00413611019, 0.003758798121, 0.003406104865,
   0.003079391085, 0.002779910341,  0.00250880653, 0.002267106902, 0.002055719495,
   0.001875429531, 0.001726895571, 0.001610647887,   0.0015270859, 0.001476477017,
   0.001458955579
};

//滤波器
void arm_fir_f32_lp(float *testInput_f32_1000Hz)
{ 
        uint32_t i; 
        arm_fir_instance_f32 S; 
        float32_t *inputf32, *outputf32; 
        inputf32 = &testInput_f32_1000Hz[0]; 
        outputf32 = &testOutput[0];
        arm_fir_init_f32(&S, NUM_TAPS, (float32_t*)&firCoeffsF32LP[0], &firStatef32[0], blockSize); 
        for(i=0; i < numBlocks; i++) { 
            arm_fir_f32(&S, inputf32 + (i * blockSize), outputf32 + (i * blockSize), blockSize); 
        }     
}





